---
import Grid from "../../layouts/Grid.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  const tags = new Set(posts.flatMap((post) => post.data.tags || []));
  return Array.from(tags).map((tag) => ({
    params: { tag },
    props: { tag },
  }));
}

const { tag } = Astro.params;
const posts = (await getCollection("blog")).filter((p) =>
  p.data.tags?.includes(tag)
);
---

<Grid posts={posts} title={`Posts tagged: ${tag}`} />
